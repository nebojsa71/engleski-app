<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Engleski za putovanja</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f9fafb;
      color: #111827;
    }
    header {
      background: #4f46e5;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
    }
    .container {
      max-width: 900px;
      margin: 1rem auto;
      padding: 0 1rem;
    }
    .lesson {
      background: white;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.3s;
    }
    .lesson:hover {
      background: #eef;
    }
    .phrases {
      display: none;
      margin-top: 1rem;
    }
    .phrase {
      padding: 0.5rem 0;
      border-bottom: 1px solid #ddd;
    }
    .phrase:last-child {
      border-bottom: none;
    }
    .quiz-btn {
      margin-top: 0.5rem;
      padding: 0.4rem 0.8rem;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .listen-btn {
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 0.3rem 0.6rem;
      margin-top: 5px;
      font-size: 0.8rem;
      cursor: pointer;
    }
    .progress {
      text-align: center;
      margin-top: 1rem;
      font-weight: bold;
    }
    .bar {
      height: 10px;
      background: #ddd;
      margin: 0.5rem 0;
      border-radius: 5px;
      overflow: hidden;
    }
    .bar-inner {
      height: 100%;
      background: #4f46e5;
      width: 0%;
    }
  </style>
</head>
<body>
<header>Engleski za putovanja</header>
<div class="container">
  <div class="progress">
    Napredak: <span id="progress-text">0%</span>
    <div class="bar"><div class="bar-inner" id="bar-inner"></div></div>
  </div>
  <div id="lessons"></div>
</div>

<script>
function updateProgress(total) {
  let done = 0;
  for (let i = 0; i < total; i++) {
    if (localStorage.getItem('lesson_' + i) === 'done') done++;
  }
  const percent = Math.round(done / total * 100);
  document.getElementById('progress-text').innerText = percent + '%';
  document.getElementById('bar-inner').style.width = percent + '%';
}

function speak(text) {
  if (!('speechSynthesis' in window)) {
    alert('Ova funkcija nije podržana.');
    return;
  }
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'en-US';
  window.speechSynthesis.speak(utter);
}

function createLesson(index, lesson) {
  const div = document.createElement('div');
  div.className = 'lesson';
  div.innerHTML = `<h3>${lesson.title}</h3><div class='phrases'></div>`;
  const phrasesDiv = div.querySelector('.phrases');
  lesson.phrases.forEach(p => {
    const pDiv = document.createElement('div');
    pDiv.className = 'phrase';
    pDiv.innerHTML = `
      <strong>${p.eng}</strong><br>
      ${p.sr}<br>
      <em>${p.pron}</em><br>
      <button class='listen-btn' onclick="speak('${p.eng}')">Listen</button>
    `;
    phrasesDiv.appendChild(pDiv);
  });
  const quizBtn = document.createElement('button');
  quizBtn.textContent = 'Kviz';
  quizBtn.className = 'quiz-btn';
  quizBtn.onclick = () => {
    let correct = 0;
    const options = lesson.phrases;
    for (let i = 0; i < 5; i++) {
      const q = options[Math.floor(Math.random() * options.length)];
      const a = prompt(`Prevedi: "${q.eng}"`);
      if (a && a.trim().toLowerCase() === q.sr.toLowerCase()) correct++;
    }
    alert(`Rezultat: ${correct}/5`);
    if (correct >= 4) {
      localStorage.setItem('lesson_' + index, 'done');
      updateProgress(lessonCount);
    }
  };
  phrasesDiv.appendChild(quizBtn);

  div.onclick = (e) => {
    if (e.target.classList.contains('listen-btn') || e.target.classList.contains('quiz-btn')) return;
    phrasesDiv.style.display = phrasesDiv.style.display === 'block' ? 'none' : 'block';
  };
  document.getElementById('lessons').appendChild(div);
}

let lessonCount = 0;

fetch('lessons.json?v=' + Date.now())
  .then(res => res.json())
  .then(data => {
    lessonCount = data.length;
    data.forEach((lesson, i) => createLesson(i, lesson));
    updateProgress(lessonCount);
  })
  .catch(err => {
    document.getElementById('lessons').innerHTML = '<p style="color:red;">Greška pri učitavanju lekcija.</p>';
    console.error(err);
  });
</script>
</body>
</html>
